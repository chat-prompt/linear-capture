# i18n (다국어 처리) 구현

## TL;DR

> **Quick Summary**: Linear Capture 앱에 한국어/영어 다국어 지원 추가. i18next 라이브러리로 ~150개 하드코딩 문자열을 추출하고, Settings에서 언어 변경 가능하게 구현.
> 
> **Deliverables**:
> - i18next 인프라 설정 (Main + Renderer process)
> - 한국어/영어 번역 JSON 파일
> - Settings 페이지 언어 선택 드롭다운
> - 모든 HTML/TS 파일의 하드코딩 문자열 교체
> 
> **Estimated Effort**: Medium (2-3일)
> **Parallel Execution**: YES - 3 waves
> **Critical Path**: Task 1 → Task 2 → Task 3 → Task 5/6/7 (parallel) → Task 8

---

## Context

### Original Request
다국어 처리를 하고 싶은데 어떻게 하면 좋을지 계획

### Interview Summary
**Key Discussions**:
- 지원 언어: 한국어 + 영어
- 기본 언어(fallback): 영어
- 언어 감지: 시스템 자동 감지 (`app.getLocale()`) + Settings에서 수동 변경
- 라이브러리: i18next
- 테스트: TDD (vitest)
- UI: Settings 페이지에 언어 선택 드롭다운
- 트레이 메뉴: 영어 유지 (로컬라이즈 제외)
- 온보딩: 시스템 언어로 시작 (언어 선택 단계 없음)

**Research Findings**:
- 현재 ~150개 하드코딩 문자열 (한국어 40%, 영어 35%, 혼합 25%)
- 기존 i18n 인프라 없음
- electron-store 이미 사용 중 → 언어 설정 저장에 활용
- Main/Renderer 프로세스 분리 → 각각 i18next 초기화 필요

### Metis Review
**Identified Gaps** (addressed):
- Main process 다이얼로그 타이밍 → i18next 초기화를 app.ready 전에 완료
- 언어 변경 시 모든 창 동기화 → IPC 이벤트로 전파
- 테스트 문자열 → 언어 독립적 유지

---

## Work Objectives

### Core Objective
Linear Capture 앱에 한국어/영어 다국어 지원을 추가하여 사용자가 선호하는 언어로 앱을 사용할 수 있게 한다.

### Concrete Deliverables
- `src/main/i18n.ts` - Main process i18next 설정
- `src/renderer/i18n.ts` - Renderer process i18next 설정
- `locales/en/translation.json` - 영어 번역 파일
- `locales/ko/translation.json` - 한국어 번역 파일
- `src/services/settings-store.ts` - getLanguage/setLanguage 함수 추가
- `src/renderer/settings.html` - 언어 선택 드롭다운 UI
- 모든 HTML/TS 파일의 하드코딩 문자열 → i18n 함수 호출로 교체

### Definition of Done
- [x] `bun test` 전체 테스트 통과
- [x] 영어 시스템에서 앱 실행 시 영어로 표시
- [x] 한국어 시스템에서 앱 실행 시 한국어로 표시
- [x] Settings에서 언어 변경 시 즉시 반영 (새로고침 없이)
- [x] 앱 재시작 후에도 선택한 언어 유지

### Must Have
- i18next 라이브러리 설치 및 설정
- 한국어/영어 번역 파일
- Main process 번역 (dialogs, notifications)
- Renderer process 번역 (HTML UI)
- 언어 설정 저장/로드 (electron-store)
- Settings UI 언어 선택기

### Must NOT Have (Guardrails)
- ❌ 트레이 메뉴 로컬라이즈 (영어 유지)
- ❌ 온보딩에 언어 선택 단계 추가
- ❌ ko/en 외 다른 언어 추가
- ❌ 창별 개별 언어 설정 (앱 전체 단일 언어)
- ❌ CDN에서 번역 로드 (모두 번들링)
- ❌ RTL 언어 지원
- ❌ date-fns 등 날짜/숫자 로컬라이즈 (문자열만)

---

## Verification Strategy (MANDATORY)

### Test Decision
- **Infrastructure exists**: YES (vitest 설치됨)
- **User wants tests**: TDD
- **Framework**: vitest (bun test)

### TDD Workflow

Each TODO follows RED-GREEN-REFACTOR:

1. **RED**: 실패하는 테스트 먼저 작성
   - `bun test [file]` → FAIL 확인
2. **GREEN**: 테스트 통과하는 최소 코드 구현
   - `bun test [file]` → PASS 확인
3. **REFACTOR**: 코드 정리 (테스트 유지)
   - `bun test [file]` → PASS 유지

---

## Execution Strategy

### Parallel Execution Waves

```
Wave 1 (Start Immediately):
└── Task 1: i18n 인프라 + 테스트 설정 [no dependencies]

Wave 2 (After Wave 1):
├── Task 2: 번역 파일 생성 [depends: 1]
├── Task 3: settings-store 확장 [depends: 1]
└── Task 4: Main process i18n 적용 [depends: 1]

Wave 3 (After Wave 2):
├── Task 5: settings.html 번역 [depends: 2, 3]
├── Task 6: onboarding.html 번역 [depends: 2]
└── Task 7: index.html 번역 [depends: 2]

Wave 4 (After Wave 3):
└── Task 8: Settings 언어 선택 UI + 통합 테스트 [depends: 3, 5]

Critical Path: 1 → 2 → 5 → 8
```

### Dependency Matrix

| Task | Depends On | Blocks | Can Parallelize With |
|------|------------|--------|---------------------|
| 1 | None | 2, 3, 4 | None |
| 2 | 1 | 5, 6, 7 | 3, 4 |
| 3 | 1 | 5, 8 | 2, 4 |
| 4 | 1 | None | 2, 3 |
| 5 | 2, 3 | 8 | 6, 7 |
| 6 | 2 | None | 5, 7 |
| 7 | 2 | None | 5, 6 |
| 8 | 3, 5 | None | None (final) |

---

## TODOs

- [x] 1. i18n 인프라 설정 + 테스트 환경 ✅ (b885079)

  **What to do**:
  - i18next, i18next-fs-backend 패키지 설치
  - `src/main/i18n.ts` 생성 - Main process i18next 초기화
  - `src/renderer/i18n.ts` 생성 - Renderer process i18next 초기화
  - `src/__tests__/i18n.test.ts` 생성 - i18n 유닛 테스트
  - locales 디렉토리 구조 생성

  **Must NOT do**:
  - CDN 로드 방식 사용 금지
  - react-i18next 설치 금지 (vanilla JS 사용)

  **Recommended Agent Profile**:
  - **Category**: `quick`
    - Reason: 라이브러리 설치 + 보일러플레이트 설정
  - **Skills**: [`git-master`]
    - `git-master`: 커밋 메시지 작성

  **Parallelization**:
  - **Can Run In Parallel**: NO
  - **Parallel Group**: Wave 1 (단독)
  - **Blocks**: Tasks 2, 3, 4
  - **Blocked By**: None (can start immediately)

  **References**:

  **Pattern References**:
  - `src/services/settings-store.ts` - electron-store 사용 패턴 (언어 설정 저장에 동일 패턴 사용)

  **API/Type References**:
  - i18next 공식 문서: https://www.i18next.com/overview/configuration-options

  **Test References**:
  - `src/__tests__/example.test.ts` - vitest 테스트 패턴

  **Acceptance Criteria**:

  **TDD:**
  - [ ] Test file created: `src/__tests__/i18n.test.ts`
  - [ ] Test covers: i18next 초기화, getLanguage/setLanguage
  - [ ] `bun test src/__tests__/i18n.test.ts` → PASS

  **Automated Verification:**
  ```bash
  # 패키지 설치 확인
  cat package.json | grep i18next
  # Assert: "i18next" 존재

  # 파일 생성 확인
  ls src/main/i18n.ts src/renderer/i18n.ts locales/
  # Assert: 모든 파일/디렉토리 존재

  # 테스트 실행
  bun test src/__tests__/i18n.test.ts
  # Assert: All tests pass
  ```

  **Commit**: YES
  - Message: `feat(i18n): setup i18next infrastructure and test environment`
  - Files: `package.json`, `src/main/i18n.ts`, `src/renderer/i18n.ts`, `src/__tests__/i18n.test.ts`, `locales/`

---

- [x] 2. 번역 파일 생성 (en/ko) ✅ (938a8a9)

  **What to do**:
  - `locales/en/translation.json` - 영어 번역 (~150개 문자열)
  - `locales/ko/translation.json` - 한국어 번역 (~150개 문자열)
  - 키 구조: `common.`, `settings.`, `capture.`, `onboarding.`, `dialogs.`
  - 모든 기존 하드코딩 문자열 추출하여 JSON에 추가

  **Must NOT do**:
  - 트레이 메뉴 문자열 포함 금지 (영어 유지)
  - 5개 이상 namespace 분리 금지 (단일 파일)

  **Recommended Agent Profile**:
  - **Category**: `unspecified-low`
    - Reason: 단순 문자열 추출 및 JSON 작성
  - **Skills**: []

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 2 (with Tasks 3, 4)
  - **Blocks**: Tasks 5, 6, 7
  - **Blocked By**: Task 1

  **References**:

  **Pattern References**:
  - `src/renderer/index.html:전체` - UI 문자열 (버튼, 라벨, 플레이스홀더)
  - `src/renderer/settings.html:전체` - 설정 페이지 문자열
  - `src/renderer/onboarding.html:전체` - 온보딩 문자열
  - `src/services/auto-updater.ts:64-187` - 다이얼로그 메시지
  - `src/main/index.ts:225-230` - 권한 요청 다이얼로그
  - `src/main/hotkey.ts` - 유효성 검사 에러 메시지

  **Acceptance Criteria**:

  **Automated Verification:**
  ```bash
  # JSON 파일 존재 확인
  ls locales/en/translation.json locales/ko/translation.json
  # Assert: 두 파일 모두 존재

  # JSON 유효성 검사
  cat locales/en/translation.json | jq .
  cat locales/ko/translation.json | jq .
  # Assert: 유효한 JSON

  # 키 개수 확인
  cat locales/en/translation.json | jq 'keys | length'
  # Assert: 5개 이상 (common, settings, capture, onboarding, dialogs)

  # 한/영 키 일치 확인
  bun -e "
    const en = require('./locales/en/translation.json');
    const ko = require('./locales/ko/translation.json');
    const enKeys = JSON.stringify(Object.keys(en).sort());
    const koKeys = JSON.stringify(Object.keys(ko).sort());
    console.log(enKeys === koKeys ? 'MATCH' : 'MISMATCH');
  "
  # Assert: MATCH
  ```

  **Commit**: YES
  - Message: `feat(i18n): add en/ko translation files`
  - Files: `locales/en/translation.json`, `locales/ko/translation.json`

---

- [x] 3. settings-store 언어 설정 함수 추가 ✅ (0e185f2)

  **What to do**:
  - `getLanguage(): string` - 저장된 언어 또는 시스템 언어 반환
  - `setLanguage(lang: string): void` - 언어 설정 저장
  - `getSupportedLanguages(): string[]` - 지원 언어 목록 반환
  - 시스템 언어 감지: `app.getLocale()` → 'ko' or 'en'
  - TDD: 테스트 먼저 작성

  **Must NOT do**:
  - 지원하지 않는 언어 저장 허용 금지
  - 창별 개별 언어 설정 금지

  **Recommended Agent Profile**:
  - **Category**: `quick`
    - Reason: 기존 패턴 따라 함수 3개 추가
  - **Skills**: [`git-master`]

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 2 (with Tasks 2, 4)
  - **Blocks**: Tasks 5, 8
  - **Blocked By**: Task 1

  **References**:

  **Pattern References**:
  - `src/services/settings-store.ts:전체` - 기존 settings 함수 패턴 (getCaptureHotkey, setCaptureHotkey 참고)

  **Test References**:
  - `src/__tests__/linear-local-cache.test.ts` - electron-store 모킹 패턴

  **Acceptance Criteria**:

  **TDD:**
  - [ ] Test file: `src/__tests__/i18n-settings.test.ts`
  - [ ] Tests cover: getLanguage 기본값, setLanguage 저장, 시스템 언어 감지
  - [ ] `bun test src/__tests__/i18n-settings.test.ts` → PASS

  **Automated Verification:**
  ```bash
  # 함수 존재 확인
  grep -n "export function getLanguage" src/services/settings-store.ts
  grep -n "export function setLanguage" src/services/settings-store.ts
  # Assert: 두 함수 모두 존재

  # 테스트 실행
  bun test src/__tests__/i18n-settings.test.ts
  # Assert: All tests pass
  ```

  **Commit**: YES
  - Message: `feat(i18n): add language settings to settings-store`
  - Files: `src/services/settings-store.ts`, `src/__tests__/i18n-settings.test.ts`

---

- [x] 4. Main process i18n 적용

  **What to do**:
  - `src/main/index.ts`에서 i18n 초기화 (app.ready 전)
  - `showPermissionNotification()` 다이얼로그 번역 적용
  - `showNotification()` 함수 번역 적용
  - IPC 핸들러 추가: `get-language`, `set-language`, `language-changed` 이벤트

  **Must NOT do**:
  - 트레이 메뉴 번역 금지 (tray.ts 수정 금지)

  **Recommended Agent Profile**:
  - **Category**: `quick`
    - Reason: 기존 코드에 i18n 함수 호출 추가
  - **Skills**: []

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 2 (with Tasks 2, 3)
  - **Blocks**: None
  - **Blocked By**: Task 1

  **References**:

  **Pattern References**:
  - `src/main/index.ts:225-240` - showPermissionNotification 함수
  - `src/main/index.ts:505-506` - showNotification 함수
  - `src/services/auto-updater.ts:64-187` - dialog.showMessageBox 호출들

  **Acceptance Criteria**:

  **Automated Verification:**
  ```bash
  # i18n import 확인
  grep -n "import.*i18n" src/main/index.ts
  # Assert: i18n import 존재

  # t() 함수 사용 확인
  grep -n "t(" src/main/index.ts
  # Assert: t() 함수 호출 존재

  # IPC 핸들러 확인
  grep -n "ipcMain.handle.*language" src/main/index.ts
  # Assert: language 관련 IPC 핸들러 존재
  ```

  **Commit**: YES
  - Message: `feat(i18n): apply i18n to main process dialogs and notifications`
  - Files: `src/main/index.ts`, `src/services/auto-updater.ts`

---

- [x] 5. settings.html 번역 적용 ✅ (4dc7b8b)

  **What to do**:
  - HTML 내 하드코딩 문자열 → `data-i18n` 속성 또는 JS로 동적 설정
  - Renderer i18n 초기화 스크립트 추가
  - 언어 변경 시 실시간 UI 업데이트 (IPC 리스너)
  - 예: `<label>토큰을 입력하세요</label>` → `<label data-i18n="settings.tokenPlaceholder"></label>`

  **Must NOT do**:
  - 페이지 새로고침으로 언어 변경 금지 (실시간 업데이트)

  **Recommended Agent Profile**:
  - **Category**: `unspecified-low`
    - Reason: HTML 문자열 교체 작업
  - **Skills**: [`frontend-ui-ux`]
    - `frontend-ui-ux`: HTML/CSS 수정

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 3 (with Tasks 6, 7)
  - **Blocks**: Task 8
  - **Blocked By**: Tasks 2, 3

  **References**:

  **Pattern References**:
  - `src/renderer/settings.html:전체` - 현재 하드코딩 문자열 위치
  - `locales/ko/translation.json:settings.*` - 번역 키

  **Acceptance Criteria**:

  **Automated Verification:**
  ```bash
  # data-i18n 속성 사용 확인
  grep -c "data-i18n" src/renderer/settings.html
  # Assert: 10개 이상

  # 한국어 하드코딩 감소 확인
  grep -c "토큰" src/renderer/settings.html
  grep -c "연결" src/renderer/settings.html
  # Assert: 0 (모두 i18n으로 교체)
  ```

  **Integration Test (Playwright):**
  ```
  # Agent executes via playwright browser automation:
  1. npm run pack
  2. Navigate to: settings window
  3. Verify: Language dropdown exists
  4. Select: English
  5. Assert: "Settings" text visible (not "설정")
  6. Select: Korean
  7. Assert: Korean text visible
  8. Screenshot: .sisyphus/evidence/task-5-settings-i18n.png
  ```

  **Commit**: YES
  - Message: `feat(i18n): apply translations to settings.html`
  - Files: `src/renderer/settings.html`

---

- [x] 6. onboarding.html 번역 적용 ✅ (7ff1820)

  **What to do**:
  - HTML 내 하드코딩 문자열 → i18n 키로 교체
  - Renderer i18n 초기화 스크립트 추가
  - 시스템 언어에 따라 자동 표시

  **Must NOT do**:
  - 온보딩에 언어 선택 UI 추가 금지

  **Recommended Agent Profile**:
  - **Category**: `unspecified-low`
    - Reason: HTML 문자열 교체 작업
  - **Skills**: [`frontend-ui-ux`]

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 3 (with Tasks 5, 7)
  - **Blocks**: None
  - **Blocked By**: Task 2

  **References**:

  **Pattern References**:
  - `src/renderer/onboarding.html:전체` - 현재 하드코딩 문자열
  - `locales/ko/translation.json:onboarding.*` - 번역 키

  **Acceptance Criteria**:

  **Automated Verification:**
  ```bash
  # data-i18n 속성 사용 확인
  grep -c "data-i18n" src/renderer/onboarding.html
  # Assert: 5개 이상

  # 한국어 하드코딩 감소 확인
  grep -c "권한" src/renderer/onboarding.html
  grep -c "단축키" src/renderer/onboarding.html
  # Assert: 0 (모두 i18n으로 교체)
  ```

  **Commit**: YES
  - Message: `feat(i18n): apply translations to onboarding.html`
  - Files: `src/renderer/onboarding.html`

---

- [x] 7. index.html 번역 적용 ✅ (7a1cb64)

  **What to do**:
  - HTML 내 하드코딩 문자열 → i18n 키로 교체
  - Renderer i18n 초기화 스크립트 추가
  - 동적 콘텐츠 (에러 메시지, 상태 등) JS에서 t() 호출

  **Must NOT do**:
  - Linear API 응답 데이터 번역 금지 (팀명, 프로젝트명 등)

  **Recommended Agent Profile**:
  - **Category**: `unspecified-low`
    - Reason: HTML 문자열 교체 작업 (가장 큰 파일)
  - **Skills**: [`frontend-ui-ux`]

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 3 (with Tasks 5, 6)
  - **Blocks**: None
  - **Blocked By**: Task 2

  **References**:

  **Pattern References**:
  - `src/renderer/index.html:전체` - 현재 하드코딩 문자열 (~85개)
  - `locales/ko/translation.json:capture.*` - 번역 키

  **Acceptance Criteria**:

  **Automated Verification:**
  ```bash
  # data-i18n 속성 사용 확인
  grep -c "data-i18n" src/renderer/index.html
  # Assert: 20개 이상

  # 주요 한국어 문자열 감소 확인
  grep -c "분석" src/renderer/index.html
  grep -c "캡처" src/renderer/index.html
  grep -c "이슈" src/renderer/index.html
  # Assert: 각각 0 또는 최소화 (모두 i18n으로 교체)
  ```

  **Commit**: YES
  - Message: `feat(i18n): apply translations to index.html`
  - Files: `src/renderer/index.html`

---

- [x] 8. Settings 언어 선택 UI + 통합 테스트 ✅ (0e185f2, 3afe23a)

  **What to do**:
  - Settings 페이지에 Language 드롭다운 추가 (English / 한국어)
  - 선택 시 즉시 UI 업데이트 + electron-store 저장
  - 전체 통합 테스트 실행
  - 앱 패키징 후 E2E 검증

  **Must NOT do**:
  - 앱 재시작 요구 금지 (실시간 변경)

  **Recommended Agent Profile**:
  - **Category**: `quick`
    - Reason: UI 컴포넌트 추가 + 테스트
  - **Skills**: [`frontend-ui-ux`, `playwright`]
    - `frontend-ui-ux`: 드롭다운 UI
    - `playwright`: E2E 테스트

  **Parallelization**:
  - **Can Run In Parallel**: NO
  - **Parallel Group**: Wave 4 (최종)
  - **Blocks**: None (final task)
  - **Blocked By**: Tasks 3, 5

  **References**:

  **Pattern References**:
  - `src/renderer/settings.html` - 기존 form-group 패턴 따라 드롭다운 추가

  **Acceptance Criteria**:

  **TDD:**
  - [ ] Integration test: `src/__tests__/i18n-integration.test.ts`
  - [ ] `bun test` → ALL PASS

  **Automated Verification:**
  ```bash
  # 전체 테스트 실행
  bun test
  # Assert: All tests pass

  # 빌드 확인
  npm run build
  # Assert: No errors
  ```

  **Integration Test (Playwright):**
  ```
  # Agent executes via playwright browser automation:
  1. npm run pack
  2. Open app: 'release/mac-arm64/Linear Capture.app'
  3. Navigate to: Settings
  4. Locate: Language dropdown
  5. Select: English
  6. Assert: All visible text in English
  7. Close Settings
  8. Open Settings again
  9. Assert: Language still English (persisted)
  10. Select: 한국어
  11. Assert: All visible text in Korean
  12. Screenshot: .sisyphus/evidence/task-8-language-switch.png
  ```

  **Commit**: YES
  - Message: `feat(i18n): add language selector to Settings and integration tests`
  - Files: `src/renderer/settings.html`, `src/__tests__/i18n-integration.test.ts`

---

## Commit Strategy

| After Task | Message | Files |
|------------|---------|-------|
| 1 | `feat(i18n): setup i18next infrastructure` | package.json, src/main/i18n.ts, src/renderer/i18n.ts |
| 2 | `feat(i18n): add en/ko translation files` | locales/ |
| 3 | `feat(i18n): add language settings to settings-store` | src/services/settings-store.ts |
| 4 | `feat(i18n): apply i18n to main process` | src/main/index.ts, src/services/auto-updater.ts |
| 5 | `feat(i18n): apply translations to settings.html` | src/renderer/settings.html |
| 6 | `feat(i18n): apply translations to onboarding.html` | src/renderer/onboarding.html |
| 7 | `feat(i18n): apply translations to index.html` | src/renderer/index.html |
| 8 | `feat(i18n): add language selector UI` | src/renderer/settings.html |

---

## Success Criteria

### Verification Commands
```bash
# 전체 테스트
bun test
# Expected: All tests pass

# 빌드
npm run build
# Expected: No errors

# 패키징
npm run pack
# Expected: .app 생성 성공
```

### Final Checklist
- [x] All "Must Have" present
- [x] All "Must NOT Have" absent
- [x] All tests pass (`bun test`)
- [x] Build succeeds (`npm run build`)
- [x] Language persists across app restart
- [x] Language changes immediately without page refresh
- [x] System locale auto-detected on first run
