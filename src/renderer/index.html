<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="capture.title">Create Linear Issue</title>
  <link rel="stylesheet" href="styles/tokens.css">
  <link rel="stylesheet" href="styles/reset.css">
  <link rel="stylesheet" href="styles/base.css">
  <link rel="stylesheet" href="styles/components/forms.css">
  <link rel="stylesheet" href="styles/components/buttons.css">
  <link rel="stylesheet" href="styles/components/spinner.css">
  <link rel="stylesheet" href="styles/pages/issue-form.css">
  <link rel="stylesheet" href="styles/features/gallery.css">
  <link rel="stylesheet" href="styles/features/dropdown.css">
  <link rel="stylesheet" href="styles/features/context.css">
</head>
<body>
  <!-- Top bar with Settings button (aligned with traffic lights) -->
  <div class="top-bar">
    <button id="settingsBtn" class="icon-btn" title="Settings">&#9881;&#65039;</button>
  </div>

  <div class="container">
    <!-- Token warning banner -->
    <div id="tokenWarning" class="token-warning hidden">
      <div class="token-warning-content">
        <span class="token-warning-icon">&#9888;&#65039;</span>
        <span data-i18n="dialogs.tokenWarning">Linear API token not set</span>
      </div>
      <button class="token-warning-btn" id="tokenWarningBtn" data-i18n="dialogs.tokenWarningButton">Set up</button>
    </div>

    <div class="header">
      <h1 data-i18n="capture.title">Create Linear Issue</h1>
      <div class="shortcut-hint" id="shortcutHint"></div>
    </div>

    <!-- Image Gallery (multiple images) -->
    <div id="imageGallery" class="image-gallery"></div>

    <!-- AI Analysis Section (hidden on success) -->
    <div id="aiAnalysisSection">
      <!-- User Hint Input -->
      <div class="form-group">
        <textarea id="userHint" data-i18n-placeholder="form.userHintPlaceholder" placeholder="(Optional) Write what the AI should focus on when creating the Linear issue"></textarea>
      </div>

      <!-- Legacy single preview (hidden) -->
      <img id="preview" class="preview" src="" alt="Screenshot preview" />

      <div class="row ai-model-row">
        <div class="form-group">
          <label for="aiModel" data-i18n="form.aiModel">AI Model</label>
          <select id="aiModel" name="aiModel">
            <option value="gemini" selected>Gemini 3 Flash (Default)</option>
            <option value="haiku">Claude Haiku 4.5</option>
          </select>
        </div>
        <div class="form-group">
          <button type="button" id="reanalyzeBtn" class="btn-submit">Start Analysis</button>
        </div>
      </div>
    </div>

    <div id="aiLoading" class="ai-loading hidden">
      <div class="spinner"></div>
      <span id="aiLoadingText" data-i18n="capture.analyzing">AI is analyzing the screenshot...</span>
    </div>

    <form id="issueForm">
      <div class="form-group">
        <label for="title" data-i18n="form.titleRequired">Title *</label>
        <input type="text" id="title" name="title" required data-i18n-placeholder="form.titlePlaceholder" placeholder="Target - Specific content (e.g., Login - Fix session expiry error)" />
      </div>

      <div class="form-group">
        <label for="description" data-i18n="form.description">Description</label>
        <textarea id="description" name="description" data-i18n-placeholder="form.descriptionPlaceholder" placeholder="Optional description..."></textarea>
      </div>

      <!-- Related Context Section (unified search for Slack, Notion, AI recommendations) -->
      <div id="relatedContextSection" class="related-context-section">
        <div class="related-context-header" id="relatedContextHeader">
          <div class="related-context-header-left">
            <span class="related-context-header-icon">&#128206;</span>
            <span class="related-context-header-title" data-i18n="relatedContext.findFrom">Find related content from Slack/Notion/Gmail</span>
            <span class="related-context-header-badge" id="relatedContextBadge" style="display: none;">0</span>
          </div>
          <span class="related-context-header-toggle">&#9660;</span>
        </div>
        <div class="related-context-body">
          <!-- Not Connected Banner -->
          <div id="relatedContextNotConnected" class="related-context-not-connected-banner" style="display: none;">
            <div class="not-connected-content">
              <span class="not-connected-icon">&#128268;</span>
              <span class="not-connected-text" data-i18n="relatedContext.notConnectedHint">Connect Slack, Notion, or Gmail to search related content</span>
            </div>
            <button type="button" class="not-connected-btn" id="relatedContextOpenSettings" data-i18n="relatedContext.openSettings">Open Settings</button>
          </div>
          <!-- Search Row -->
          <div class="related-context-search-row">
            <input type="text"
                   class="related-context-search-input"
                   id="relatedContextSearchInput"
                   data-i18n-placeholder="relatedContext.searchPlaceholder"
                   placeholder="Search related context...">
            <button type="button"
                    class="related-context-refresh-btn"
                    id="relatedContextRefreshBtn"
                    title="Reset to title">
              &#128260;
            </button>
          </div>

          <!-- Status Hint -->
          <div class="related-context-status" id="relatedContextStatus">
            <span>&#128161;</span>
            <span data-i18n="relatedContext.hint">Edit search to refine results</span>
          </div>

          <!-- Loading -->
          <div id="relatedContextLoading" class="related-context-loading" style="display: none;">
            <div class="spinner"></div>
            <span data-i18n="relatedContext.searching">Searching Slack, Notion...</span>
          </div>

          <!-- Results -->
          <div id="relatedContextResults" class="related-context-results"></div>

          <!-- Empty State -->
          <div id="relatedContextEmpty" class="related-context-empty" style="display: none;">
            <span>&#129335;</span>
            <span data-i18n="relatedContext.noResults">No results found. Try different keywords.</span>
          </div>

          <!-- Actions -->
          <div class="related-context-actions" id="relatedContextActions" style="display: none;">
            <span class="related-context-selected-count" id="relatedContextSelectedCount">0 selected</span>
            <button type="button" class="related-context-insert-btn" id="relatedContextInsertBtn" disabled>
              <span>&#128206;</span>
              <span data-i18n="relatedContext.insertToDescription">Insert to Description</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Linear Section - No auto-translate -->
      <div id="linearSection" data-no-translate>
      <div class="row">
        <div class="form-group">
          <label for="team">Team *</label>
          <select id="team" name="team" required>
<option value="">Select team...</option>
          </select>
        </div>

        <div class="form-group">
          <label for="project">Project</label>
          <div class="searchable-select" id="projectContainer">
            <button type="button" class="select-trigger" id="projectTrigger">
              <span>None</span>
            </button>
            <div class="dropdown" id="projectDropdown">
              <input type="text" class="search-input" id="projectSearch" placeholder="Search projects...">
              <div class="options" id="projectOptions"></div>
            </div>
            <input type="hidden" id="project" name="project" value="">
          </div>
        </div>
      </div>

      <div class="row">
        <div class="form-group">
          <label for="status">Status</label>
          <select id="status" name="status">
            <option value="">Default</option>
          </select>
        </div>

        <div class="form-group">
          <label for="priority">Priority</label>
          <select id="priority" name="priority">
            <option value="">No priority</option>
            <option value="1">&#128308; Urgent</option>
            <option value="2">&#128992; High</option>
            <option value="3">&#128993; Medium</option>
            <option value="4">&#128994; Low</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="form-group">
          <label for="assignee">Assignee</label>
          <div class="searchable-select" id="assigneeContainer">
            <button type="button" class="select-trigger" id="assigneeTrigger">
              <span>Unassigned</span>
            </button>
            <div class="dropdown" id="assigneeDropdown">
              <input type="text" class="search-input" id="assigneeSearch" placeholder="Search assignees...">
              <div class="options" id="assigneeOptions"></div>
            </div>
            <input type="hidden" id="assignee" name="assignee" value="">
          </div>
        </div>

        <div class="form-group">
          <label for="estimate">Estimate</label>
          <select id="estimate" name="estimate">
            <option value="">None</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="form-group">
          <label for="cycle">Cycle</label>
          <select id="cycle" name="cycle">
            <option value="">None</option>
          </select>
        </div>

        <div class="form-group">
          <label>Labels</label>
          <div class="label-select" id="labelSelect">
            <div class="label-chips-container" id="labelChipsContainer">
              <span class="label-empty-hint" id="labelEmptyHint">+ Add labels...</span>
            </div>
            <div class="label-dropdown" id="labelDropdown">
              <input type="text" class="label-search-input" id="labelSearchInput" placeholder="Search labels...">
              <div class="label-options" id="labelOptions"></div>
            </div>
          </div>
        </div>
      </div>
      </div><!-- End linearSection -->

      <div id="error" class="error"></div>

      <div class="buttons">
        <button type="button" class="btn-cancel" id="cancelBtn" data-i18n="common.cancel">Cancel</button>
        <button type="submit" class="btn-submit" id="submitBtn" data-i18n="form.createIssue">Create Issue</button>
      </div>
    </form>

    <div id="loading" class="loading">
      <div class="spinner"></div>
      <span id="loadingText">Creating issue...</span>
    </div>

    <!-- Success Screen -->
    <div id="successScreen" class="success-screen hidden">
      <div class="success-icon">&#9989;</div>
      <div class="success-title" data-i18n="success.title">Issue created!</div>
      <div class="success-issue-id" id="successIssueId"></div>
      <div class="success-buttons">
        <button type="button" class="btn-submit" id="viewIssueBtn" data-i18n="success.viewInLinear">View in Linear</button>
        <button type="button" class="btn-cancel" id="closeSuccessBtn" data-i18n="common.close">Close</button>
      </div>
      <div class="success-hint" data-i18n="success.urlCopied">URL copied to clipboard</div>
    </div>
  </div>

  <!-- Image Preview Modal -->
  <div id="imageModal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <img id="modalImage" src="" alt="Preview" />
      <button class="modal-close" title="Close">&times;</button>
    </div>
  </div>

  <script src="scripts/main/app.js"></script>
</body>
</html>
