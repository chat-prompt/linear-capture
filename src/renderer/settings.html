<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="settings.title">Settings</title>
  <link rel="stylesheet" href="styles/tokens.css">
  <link rel="stylesheet" href="styles/reset.css">
  <link rel="stylesheet" href="styles/base.css">
  <link rel="stylesheet" href="styles/components/forms.css">
  <link rel="stylesheet" href="styles/components/buttons.css">
  <link rel="stylesheet" href="styles/components/spinner.css">
  <link rel="stylesheet" href="styles/pages/settings.css">
  <link rel="stylesheet" href="styles/features/integrations.css">
  <link rel="stylesheet" href="styles/features/channel-selector.css">
</head>
<body>
  <div class="container">
    <h1 data-i18n="settings.title">Settings</h1>

    <div class="form-group">
      <label for="token" data-i18n="settings.linearToken">Linear API Token</label>
      <div class="token-input-row">
        <input type="password" id="token" data-i18n-placeholder="settings.tokenPlaceholder" placeholder="lin_api_xxxxxxxxxxxxx">
        <div class="buttons">
          <button class="btn-danger" id="clearBtn" style="display: none;" data-i18n="common.delete">Delete</button>
          <button class="btn-primary" id="validateBtn" data-i18n="common.validateAndSave">Validate & Save</button>
        </div>
      </div>
      <div id="errorMessage" class="error-message" style="display: none;"></div>
      <p class="info-text" data-i18n="settings.tokenHint">
        Get from Linear Settings &gt; API &gt; Personal API keys
      </p>
    </div>

    <div class="status-box">
      <div class="status-row">
        <span class="status-icon" id="statusIcon">&#9203;</span>
        <span class="status-label" data-i18n="common.status">Status:</span>
        <span class="status-value" id="statusText" data-i18n="settings.enterToken">Enter your token</span>
      </div>
      <div class="status-row" id="userInfoRow" style="display: none;">
        <span class="status-icon">&#128100;</span>
        <span class="status-label" data-i18n="common.user">User:</span>
        <span class="status-value" id="userInfo"></span>
      </div>
    </div>

    <!-- Integrations Section (Unified) -->
    <div class="integrations-section">
      <h2 data-i18n="settings.integrations">Integrations</h2>
      <p class="integration-hint" data-i18n="settings.integrationHint">Used for AI search to automatically find related conversations and documents when creating issues</p>

      <!-- Slack -->
      <div class="integration-row" id="slackRow" data-service="slack">
        <svg class="integration-logo" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zm1.271 0a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313z" fill="#E01E5A"/>
          <path d="M8.834 5.042a2.528 2.528 0 0 1-2.521-2.52A2.528 2.528 0 0 1 8.834 0a2.528 2.528 0 0 1 2.521 2.522v2.52H8.834zm0 1.271a2.528 2.528 0 0 1 2.521 2.521 2.528 2.528 0 0 1-2.521 2.521H2.522A2.528 2.528 0 0 1 0 8.834a2.528 2.528 0 0 1 2.522-2.521h6.312z" fill="#36C5F0"/>
          <path d="M18.956 8.834a2.528 2.528 0 0 1 2.522-2.521A2.528 2.528 0 0 1 24 8.834a2.528 2.528 0 0 1-2.522 2.521h-2.522V8.834zm-1.27 0a2.528 2.528 0 0 1-2.522 2.521 2.528 2.528 0 0 1-2.52-2.521V2.522A2.528 2.528 0 0 1 15.165 0a2.528 2.528 0 0 1 2.521 2.522v6.312z" fill="#2EB67D"/>
          <path d="M15.165 18.956a2.528 2.528 0 0 1 2.521 2.522A2.528 2.528 0 0 1 15.165 24a2.527 2.527 0 0 1-2.52-2.522v-2.522h2.52zm0-1.27a2.527 2.527 0 0 1-2.52-2.522 2.527 2.527 0 0 1 2.52-2.52h6.313A2.528 2.528 0 0 1 24 15.165a2.528 2.528 0 0 1-2.522 2.521h-6.313z" fill="#ECB22E"/>
        </svg>
        <div class="integration-name">
          <span data-i18n="slack.title">Slack</span>
          <span class="integration-workspace" id="slackWorkspace" style="display: none;"></span>
        </div>
        <div class="integration-detail">
          <span class="integration-doc-count" id="slackDocCount"></span>
          <span class="integration-detail-sep" id="slackDetailSep" style="display: none;">·</span>
          <span class="integration-last-sync" id="slackLastSync" style="display: none;"></span>
        </div>
        <div class="integration-actions">
          <span class="integration-status" id="slackStatusText" data-i18n="slack.notConnected">Not connected</span>
          <button class="btn-integration" id="slackConnectBtn" data-i18n="common.connect">Connect</button>
          <button class="btn-sync" id="syncSlackBtn" style="display: none;" data-i18n="sync.syncNow">Sync Now</button>
          <div class="integration-menu" id="slackMenu" style="display: none;">
            <button class="btn-menu-trigger" id="slackMenuBtn">&#8942;</button>
            <div class="menu-dropdown" id="slackMenuDropdown">
              <button class="menu-item" data-action="edit-channels" data-i18n="slack.editChannels">Edit</button>
              <button class="menu-item" data-action="reconnect" data-i18n="settings.changeWorkspace">Change workspace</button>
              <button class="menu-item" data-action="disconnect" data-i18n="common.disconnect">Disconnect</button>
            </div>
          </div>
        </div>
        <div id="slackChannelHint" class="integration-channel-hint" style="display: none;">
          <span id="channelSummaryText"></span>
          <span class="hint-separator">·</span>
          <a href="#" id="editChannelsBtn" class="hint-link" data-i18n="slack.editChannels">Edit</a>
        </div>
      </div>
      <div id="slackError" class="integration-error" style="display: none;"></div>

      <!-- Notion -->
      <div class="integration-row" id="notionRow" data-service="notion">
        <svg class="integration-logo" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4.459 4.208c.746.606 1.026.56 2.428.466l13.215-.793c.28 0 .047-.28-.046-.326L17.86 1.968c-.42-.326-.98-.7-2.055-.607L3.01 2.295c-.466.046-.56.28-.374.466l1.823 1.447zm.793 3.08v13.904c0 .747.373 1.027 1.214.98l14.523-.84c.841-.046.934-.56.934-1.166V6.354c0-.606-.233-.933-.747-.886l-15.177.887c-.56.046-.747.326-.747.933zm14.337.745c.093.42 0 .84-.42.888l-.7.14v10.264c-.608.327-1.168.514-1.635.514-.747 0-.934-.234-1.495-.933l-4.577-7.186v6.952l1.448.327s0 .84-1.168.84l-3.222.186c-.093-.186 0-.653.327-.746l.84-.233V9.854L7.822 9.76c-.094-.42.14-1.026.793-1.073l3.456-.233 4.764 7.279v-6.44l-1.215-.139c-.093-.514.28-.886.747-.933l3.222-.186zM2.877.466L16.039.014c1.635-.14 2.055.093 2.755.606l3.596 2.521c.56.373.746.466.746 1.072v17.04c0 .72-.28 1.19-1.12 1.236L6.03 23.466c-.653.046-1.025-.046-1.4-.56l-3.5-4.624c-.374-.56-.514-.98-.514-1.493V1.906c0-.653.28-1.12.98-1.16l1.281-.28z" fill="#000"/>
        </svg>
        <div class="integration-name">
          <span data-i18n="notion.title">Notion</span>
          <span class="integration-workspace" id="notionWorkspace" style="display: none;"></span>
        </div>
        <div class="integration-detail">
          <span class="integration-doc-count" id="notionDocCount"></span>
          <span class="integration-detail-sep" id="notionDetailSep" style="display: none;">·</span>
          <span class="integration-last-sync" id="notionLastSync" style="display: none;"></span>
        </div>
        <div class="integration-actions">
          <span class="integration-status" id="notionStatusText" data-i18n="notion.notConnected">Not connected</span>
          <button class="btn-integration" id="notionConnectBtn" data-i18n="common.connect">Connect</button>
          <button class="btn-sync" id="syncNotionBtn" style="display: none;" data-i18n="sync.syncNow">Sync Now</button>
          <div class="integration-menu" id="notionMenu" style="display: none;">
            <button class="btn-menu-trigger" id="notionMenuBtn">&#8942;</button>
            <div class="menu-dropdown" id="notionMenuDropdown">
              <button class="menu-item" data-action="reconnect" data-i18n="settings.changeWorkspace">Change workspace</button>
              <button class="menu-item" data-action="disconnect" data-i18n="common.disconnect">Disconnect</button>
            </div>
          </div>
        </div>
      </div>
      <div id="notionError" class="integration-error" style="display: none;"></div>

      <!-- Gmail -->
      <div class="integration-row" id="gmailRow" data-service="gmail">
        <svg class="integration-logo" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636 0 0 1 0 19.366V5.457c0-2.023 2.309-3.178 3.927-1.964L5.455 4.64 12 9.548l6.545-4.91 1.528-1.145C21.69 2.28 24 3.434 24 5.457z" fill="#EA4335"/>
        </svg>
        <div class="integration-name">
          <span data-i18n="gmail.title">Gmail</span>
          <span class="integration-workspace" id="gmailWorkspace" style="display: none;"></span>
        </div>
        <div class="integration-detail">
          <span class="integration-doc-count" id="gmailDocCount"></span>
          <span class="integration-detail-sep" id="gmailDetailSep" style="display: none;">·</span>
          <span class="integration-last-sync" id="gmailLastSync" style="display: none;"></span>
        </div>
        <div class="integration-actions">
          <span class="integration-status" id="gmailStatusText" data-i18n="gmail.notConnected">Not connected</span>
          <button class="btn-integration" id="gmailConnectBtn" data-i18n="common.connect">Connect</button>
          <button class="btn-sync" id="syncGmailBtn" style="display: none;" data-i18n="sync.syncNow">Sync Now</button>
          <div class="integration-menu" id="gmailMenu" style="display: none;">
            <button class="btn-menu-trigger" id="gmailMenuBtn">&#8942;</button>
            <div class="menu-dropdown" id="gmailMenuDropdown">
              <button class="menu-item" data-action="reconnect" data-i18n="settings.changeAccount">Change account</button>
              <button class="menu-item" data-action="disconnect" data-i18n="common.disconnect">Disconnect</button>
            </div>
          </div>
        </div>
      </div>
      <div id="gmailError" class="integration-error" style="display: none;"></div>

      <!-- Linear (NO dropdown menu - API token based, not OAuth) -->
      <div class="integration-row" id="linearRow" data-service="linear">
        <svg class="integration-logo" viewBox="0 0 24 24" fill="#5E6AD2" xmlns="http://www.w3.org/2000/svg">
          <path d="M2.886 4.18A11.982 11.982 0 0 1 11.99 0C18.624 0 24 5.376 24 12.009c0 3.64-1.62 6.903-4.18 9.105L2.887 4.18ZM1.817 5.626l16.556 16.556c-.524.33-1.075.62-1.65.866L.951 7.277c.247-.575.537-1.126.866-1.65ZM.322 9.163l14.515 14.515c-.71.172-1.443.282-2.195.322L0 11.358a12 12 0 0 1 .322-2.195Zm-.17 4.862 9.823 9.824a12.02 12.02 0 0 1-9.824-9.824Z"/>
        </svg>
        <div class="integration-name">
          <span>Linear</span>
        </div>
        <div class="integration-detail">
          <span class="integration-doc-count" id="linearDocCount"></span>
          <span class="integration-detail-sep" id="linearDetailSep" style="display: none;">·</span>
          <span class="integration-last-sync" id="linearLastSync" style="display: none;"></span>
        </div>
        <div class="integration-actions">
          <span class="integration-status" id="linearStatusText" data-i18n="sync.notConnected">Not connected</span>
          <button class="btn-sync" id="syncLinearBtn" disabled data-i18n="sync.syncNow">Sync</button>
          <div class="integration-menu-placeholder"></div>
        </div>
      </div>
    </div>

    <!-- Hotkey + Language Row -->
    <div class="settings-row">
      <!-- Hotkey Section -->
      <div class="hotkey-section">
        <h2 data-i18n="hotkey.title">Capture Hotkey</h2>
        <div class="hotkey-input-container">
          <input type="text"
                 id="hotkeyInput"
                 class="hotkey-input"
                 readonly
                 data-i18n-placeholder="hotkey.placeholder"
                 placeholder="Click to record...">
          <button class="btn-reset" id="resetHotkeyBtn" data-i18n="common.reset">Reset</button>
        </div>
        <div id="hotkeyHint" class="hotkey-hint" data-i18n="hotkey.hint">Click and press new key combination</div>
        <div id="hotkeyError" class="hotkey-error" style="display: none;"></div>
        <div id="hotkeySuccess" class="hotkey-success" style="display: none;"></div>
      </div>

      <!-- Language Section -->
      <div class="hotkey-section">
        <h2 data-i18n="settings.language">Language</h2>
        <div class="form-group language-group">
          <select id="languageSelect">
            <option value="en">English</option>
            <option value="ko">&#54620;&#44397;&#50612;</option>
            <option value="de">Deutsch</option>
            <option value="fr">Fran&#231;ais</option>
            <option value="es">Espa&#241;ol</option>
          </select>
        </div>
        <div class="hotkey-hint" data-i18n="settings.languageHint">Select app display language</div>
      </div>
    </div>

    <!-- Version & Update Section -->
    <div class="version-section">
      <div class="version-info">
        <span class="version-label" data-i18n="common.version">Version</span>
        <span class="version-value" id="appVersion">-</span>
      </div>
      <button class="btn-update" id="checkUpdateBtn" data-i18n="settings.checkUpdate">Check for Updates</button>
    </div>
  </div>

  <!-- Channel Selection Modal -->
  <div id="channelSelectionModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 data-i18n="slack.selectChannels">Select Channels</h3>
        <button class="modal-close" id="modalCloseBtn">&times;</button>
      </div>
      <div class="modal-body">
        <input type="text" id="modalChannelSearch" class="channel-search-input" data-i18n-placeholder="slack.searchChannels" placeholder="Search channels...">
        <div class="channel-selector-actions">
          <div>
            <button id="modalSelectAll" class="btn-xs" data-i18n="slack.selectAll">Select All</button>
            <button id="modalDeselectAll" class="btn-xs" data-i18n="slack.deselectAll">Deselect All</button>
          </div>
          <span id="modalChannelCount" class="channel-count"></span>
        </div>
        <div id="modalChannelList" class="channel-list"></div>
      </div>
      <div class="modal-footer">
        <button id="modalSkipBtn" class="btn-secondary" data-i18n="slack.skip">Skip</button>
        <button id="modalSaveBtn" class="btn-primary" data-i18n="slack.save">Save</button>
      </div>
    </div>
  </div>

  <script src="scripts/settings/app.js"></script>
</body>
</html>
